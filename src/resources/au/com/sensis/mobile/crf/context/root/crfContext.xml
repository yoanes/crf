<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:util="http://www.springframework.org/schema/util"
        xmlns:aop="http://www.springframework.org/schema/aop"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
                http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd
                http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd">

    <bean id="crf.resourceResolverEngine" 
        class="au.com.sensis.mobile.crf.service.DelegatingPathRestrictedResourceResolverEngineBean">
        <constructor-arg ref="crf.defaultResourceResolverEngine" />
    </bean>                

    <bean id="crf.defaultResourceResolverEngine" 
        class="au.com.sensis.mobile.crf.service.ResourceResolverEngineBean">
        <constructor-arg ref="crf.configurationFactory"/>
        <constructor-arg ref="crf.resourceResolver"/>
        <constructor-arg ref="crf.resourceResolutionWarnLogger"/>
    </bean>                
        
    <bean id="crf.configurationFactory" 
        class="au.com.sensis.mobile.crf.config.ConfigurationFactoryBean">
        <constructor-arg value="@{crf.resources.config.classpath}"/>
    </bean>
    
    <bean id="crf.resourceResolver" class="au.com.sensis.mobile.crf.service.DelegatingResourceResolverBean">
        <constructor-arg>
            <list>
                <bean class="au.com.sensis.mobile.crf.service.JspResourceResolverBean">
                    <constructor-arg value="@{crf.resources.jsp.root.servlet.path}"/>
                    <constructor-arg value="@{crf.resources.jsp.abstract.extension}"/>
                    <constructor-arg value="@{crf.env.resources.jsp.root.dir}"/>
                    <constructor-arg ref="crf.resourceResolutionWarnLogger" />
                </bean>
                <bean class="au.com.sensis.mobile.crf.service.CssResourceResolverBean">
                    <constructor-arg value="@{crf.resources.css.abstract.path.extension}"/>
                    <constructor-arg value="@{crf.env.resources.css.root.dir}"/>
                    <constructor-arg ref="crf.resourceResolutionWarnLogger" />
                </bean>
                <bean class="au.com.sensis.mobile.crf.service.ImageResourceResolverBean">
                    <constructor-arg value="@{crf.resources.image.abstract.path.extension}"/>
                    <constructor-arg value="@{crf.env.resources.images.root.dir}"/>
                    <constructor-arg ref="crf.resourceResolutionWarnLogger" />
                </bean>
                <bean class="au.com.sensis.mobile.crf.service.JavaScriptResourceResolverBean">
                    <constructor-arg value="@{crf.resources.javascript.abstract.path.extension}"/>
                    <constructor-arg value="@{crf.env.resources.javascript.root.dir}"/>
                    <constructor-arg ref="crf.resourceResolutionWarnLogger" />
                </bean>
            </list>
        </constructor-arg>
    </bean>
    
    <bean id="crf.resourceResolutionWarnLogger" class="au.com.sensis.mobile.crf.service.ResourceResolutionWarnLogger" />
    
    <bean id="crf.linkTagDependencies" 
        class="au.com.sensis.mobile.crf.presentation.tag.LinkTagDependencies">
        <constructor-arg ref="crf.resourceResolverEngine" />
        <constructor-arg ref="crf.deploymentVersion" />
        <constructor-arg ref="crf.cssBundleFactory" />
        <constructor-arg value="@{crf.env.resources.css.client.path.prefix}" />
        <constructor-arg ref="crf.resourceResolutionWarnLogger" />        
    </bean>
    
    <bean id="crf.imageTagDependencies" 
        class="au.com.sensis.mobile.crf.presentation.tag.ImageTagDependencies">
        <constructor-arg ref="crf.resourceResolverEngine" />
        <constructor-arg ref="crf.deploymentVersion" />
        <constructor-arg value="@{crf.env.resources.images.client.path.prefix}" />
        <constructor-arg ref="crf.resourceResolutionWarnLogger" />        
    </bean>
    
    <bean id="crf.scriptTagDependencies" 
        class="au.com.sensis.mobile.crf.presentation.tag.ScriptTagDependencies">
        <constructor-arg ref="crf.resourceResolverEngine" />
        <constructor-arg ref="crf.deploymentVersion" />
        <constructor-arg ref="crf.scriptBundleFactory" />
        <constructor-arg value="@{crf.env.resources.javascript.client.path.prefix}" />
        <constructor-arg ref="crf.resourceResolutionWarnLogger" />        
    </bean>
    
    <bean id="crf.cssBundleFactory" class="au.com.sensis.mobile.crf.service.CssBundleFactoryBean" />
    <bean id="crf.scriptBundleFactory" class="au.com.sensis.mobile.crf.service.ScriptBundleFactoryBean" />
    
    <bean id="crf.imageServletDependencies" 
        class="au.com.sensis.mobile.crf.presentation.ImageServlet$ImageServletDependencies">
        <constructor-arg ref="crf.resourceResolverEngine" />
        <constructor-arg value="@{crf.env.resources.images.client.path.prefix}" />
    </bean>
    
    
    <!-- TODO: extract this global deploymentVersion bean (and its class) into somewhere more common? -->
    <bean id="crf.deploymentVersion" class="au.com.sensis.mobile.crf.config.DeploymentVersion">
        <property name="platform"> 
            <!-- TODO: in future, the platform will be set from a properties file. For now, only DEV is supported. -->
            <util:constant static-field="au.com.sensis.mobile.crf.config.DeploymentVersion$Platform.DEVELEOPMENT" />
        </property>
    </bean>
</beans>
